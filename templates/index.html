<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>üé§ –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
  .bot {
    display:flex;
    justify-content:center;
    margin:26px 0;
  }
  .head {
    width:120px; height:120px;
    border-radius:50%;
    background:#232842;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    position:relative;
    box-shadow:0 8px 20px rgba(0,0,0,0.4);
  }
  .eye {
    width:18px; height:18px;
    background:#7aa2ff;
    border-radius:50%;
    margin:6px;
  }
  .mouth {
    width:50px; height:12px;
    background:#3ad29f;
    border-radius:6px;
    margin-top:6px;
    transition:all 0.15s ease;
  }
  .mouth.speaking {
    height:30px;
    background:#ff6b6b;
  }
  :root{
    --bg:#0f1220;
    --card:#171a2b;
    --muted:#9aa3b2;
    --text:#e7ecf3;
    --accent:#7aa2ff;
    --ok:#3ad29f;
    --warn:#ffb869;
    --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:0;
    background: radial-gradient(1200px 600px at 10% -10%, #1b2040 0%, #0f1220 60%),
                radial-gradient(1000px 400px at 110% 0%, #182449 0%, transparent 60%),
                var(--bg);
    color:var(--text); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial;
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 16px;
  }
  .wrap{width:100%; max-width:920px}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
    backdrop-filter: blur(8px);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:24px; padding:24px; box-shadow: 0 20px 50px rgba(0,0,0,.35);
  }
  h1{margin:0 0 6px; font-size:28px}
  p.muted{margin:0 0 16px; color:var(--muted)}
  .row{display:flex; gap:12px; margin:14px 0 20px; flex-wrap:wrap}
  button{
    appearance:none; border:none; border-radius:12px; padding:12px 16px; cursor:pointer;
    background:#232842; color:var(--text); font-weight:600;
    transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
  }
  button:hover{transform: translateY(-1px);}
  button:active{transform: translateY(0);}
  .start{ background: linear-gradient(135deg, #4c8fff, #7aa2ff); }
  .stop { background: linear-gradient(135deg, #ff6b6b, #ff8a8a); }
  .refresh{ background:#2a2f54; }
  .status{font-weight:700; margin-left:auto; padding:8px 12px; border-radius:10px; background:#212646; color:#9fb1ff}
  pre{
    white-space:pre-wrap; word-wrap:break-word; background:var(--card); border-radius:14px;
    border:1px solid rgba(255,255,255,0.07); padding:14px; min-height:220px; max-height:380px; overflow:auto;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
  }
  footer{margin-top:12px; color:var(--muted); font-size:12px}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; background:#24305b; color:#b3c3ff; font-size:12px; margin-left:8px}
  
  /* drag and drop */
  #dropZone {
    border:2px dashed var(--accent);
    border-radius:14px;
    padding:30px;
    text-align:center;
    color:var(--muted);
    margin-bottom:20px;
    transition: background .2s ease;
  }
  #dropZone.dragover {
    background:rgba(122,162,255,0.1);
    color:var(--text);
  }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üé§ –ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä <span class="pill">–ª–æ–∫–∞–ª—å–Ω–æ</span></h1>
      <p class="muted">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑—é–º–µ, –¥–æ–∂–¥–∏—Ç–µ—Å—å –∞–Ω–∞–ª–∏–∑–∞ –∏ –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ.</p>

      <!-- Dropzone -->
      <div id="dropZone">üìé –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ä–µ–∑—é–º–µ (PDF/DOC/DOCX/TXT/RTF)</div>
      <pre id="analysisBox">‚è≥ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—é–º–µ –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω...</pre>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤—å—é -->
      <div class="row">
        <button class="start" id="btnStart" disabled>‚ñ∂ –°—Ç–∞—Ä—Ç</button>
        <button class="stop"  id="btnStop">‚èπ –°—Ç–æ–ø</button>
        <button class="refresh" id="btnLogs">üìú –õ–æ–≥–∏</button>
        <div class="status" id="status">—Å—Ç–æ–ø</div>
      </div>

      <!-- –†–æ–±–æ—Ç -->
      <div class="bot">
        <div class="head">
          <div style="display:flex;">
            <div class="eye"></div>
            <div class="eye"></div>
          </div>
          <div class="mouth" id="mouth"></div>
        </div>
      </div>

      <pre id="logBox">–∂—É—Ä–Ω–∞–ª –ø—É—Å—Ç...</pre>

      <footer>–ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ —Å–ª—ã—à–Ω–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∏ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.</footer>
    </div>
  </div>

<script>
const statusEl = document.getElementById('status');
const logBox   = document.getElementById('logBox');
const btnStart = document.getElementById('btnStart');
const btnStop  = document.getElementById('btnStop');
const btnLogs  = document.getElementById('btnLogs');
const mouth    = document.getElementById('mouth');
const dropZone = document.getElementById('dropZone');
const analysisBox = document.getElementById('analysisBox');

let timer = null;

// drag & drop –æ–±—Ä–∞–±–æ—Ç–∫–∞
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', () => {
  dropZone.classList.remove('dragover');
});
dropZone.addEventListener('drop', async (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (!file) return;

  analysisBox.textContent = "‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—é–º–µ...";
  const formData = new FormData();
  formData.append("file", file);

  try {
    const r = await fetch('/api/upload_resume', {method:'POST', body: formData});
    const j = await r.json();
    if (j.analysis) {
      analysisBox.textContent = j.analysis;
      btnStart.disabled = false;
    } else {
      analysisBox.textContent = "‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—é–º–µ: " + (j.error || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ");
    }
  } catch(err) {
    analysisBox.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message;
  }
});

async function startInterview(){
  statusEl.textContent = '–∑–∞–ø—É—Å–∫...';
  const r = await fetch('/api/start', {method:'POST'});
  const j = await r.json();
  if (j.status === "started") {
    statusEl.textContent = '–∏–¥—ë—Ç';
  } else {
    statusEl.textContent = j.message || '–æ—à–∏–±–∫–∞';
  }
}
async function stopInterview(){
  await fetch('/api/stop', {method:'POST'});
  statusEl.textContent = '—Å—Ç–æ–ø';
}
async function loadLogs(){
  const r = await fetch('/api/logs');
  const j = await r.json();
  logBox.textContent = j.dialogue || '–∂—É—Ä–Ω–∞–ª –ø—É—Å—Ç...';
}
btnStart.onclick = startInterview;
btnStop.onclick  = stopInterview;
btnLogs.onclick  = loadLogs;

timer = setInterval(loadLogs, 1200);
loadLogs();

// —Ä–æ—Ç-–∞–Ω–∏–º–∞—Ü–∏—è
setInterval(async ()=>{
  const r = await fetch('/api/speaking');
  const j = await r.json();
  if(j.speaking){
    mouth.classList.add('speaking');
  } else {
    mouth.classList.remove('speaking');
  }
}, 300);
</script>
</body>
</html>
